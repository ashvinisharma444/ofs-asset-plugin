<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Minimal OFS Handshake</title>
</head>
<body style="background: #ffffff; display: flex; align-items: center; justify-content: center; height: 100vh; font-family: sans-serif;">
    <div style="text-align: center;">
        <h2 id="status">Waiting for Oracle...</h2>
        <button onclick="closePlugin()" style="padding: 10px 20px; font-size: 16px; cursor: pointer;">Return to Oracle</button>
    </div>

    <script>
        var origin = "";

        // Listen for the 'init' call from Oracle
        window.addEventListener("message", function(event) {
            // Log to F12 console to verify hit
            console.log("Plugin received message:", event.data);

            var data;
            try {
                data = (typeof event.data === 'string') ? JSON.parse(event.data) : event.data;
            } catch (e) {
                return;
            }

            if (data.method === "init") {
                origin = event.origin;
                document.getElementById('status').innerText = "Connected Successfully!";

                // MANDATORY RESPONSE: Immediate handshake
                // We send it as a stringified JSON for maximum compatibility
                var readyResponse = JSON.stringify({
                    apiVersion: 1,
                    method: 'ready'
                });

                window.parent.postMessage(readyResponse, origin);
            }
        }, false);

        function closePlugin() {
            var closeMsg = JSON.stringify({
                apiVersion: 1,
                method: 'close'
            });
            window.parent.postMessage(closeMsg, origin);
        }
    </script>
</body>
</html>
